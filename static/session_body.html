<html>
<body>
<style>
i::before{
    background:transparent;
}
body {
    font-family: Calibri, sans-serif;
    background-color: #000000;
    color:#ffffff;
    -webkit-touch-callout:none;
    -webkit-user-select:none;
    -khtml-user-select:none;
    -moz-user-select:none;
    -ms-user-select:none;
    user-select:none;
    -webkit-tap-highlight-color:rgba(0,0,0,0);
}
</style>
<script>
            var controlChannel;
            var lx = 0;
            var ly = 0;
            function sendHeartbeat() {
                if ((controlChannel) && (controlChannel.readyState == "open")) {
                    var req = "heartbeat";
                    var message = {command: req};
                    console.log("-c-> send " + req);
                    controlChannel.send(JSON.stringify(message));
                }
            }
            function omd(event) {
                console.log("omd =" + event);
                var x = Math.round(+100 - ((200.0 * event.offsetX) / 640.0));
                var y = Math.round(+100 - ((200.0 * event.offsetY) / 480.0));
                sendJoy(x, y);
            }
            function omu(event) {
		var x=0;
		var y=0;
                switch (event.keyCode){
                    case 38: // up
                    case 66:
                        y=0;
			x = lx;
                        break;
                    case 40:
                    case 70:
                        // down
                        y=0;
			x=lx;
                        break;
                    case 37:
                    case 76:
                        x=0;
			y=ly;
                        //left
                        break;
                    case 39:
                    case 82:
                        x=0;
			y=ly;
                        // right
                        break;
                }
		console.log("omu =" + event);
                sendJoy(x,y);
            }
            function sendJoy(x, y) {
                if ((controlChannel) && (controlChannel.readyState == "open")) {
		    if ((lx != x) || (ly != y)){
			lx = x;
                        ly = y;
                        var req = "joystick?x=" + x + "&y=" + y;
                        var message = {command: req};
                        console.log("-c-> send " + req);
                        controlChannel.send(JSON.stringify(message));
                   }
                }
            }
var speed = 40;
var turn = 40;
            function onkeydown(ev){
                var x =0;
                var y =0;
                switch  (ev.keyCode){
                    case 38: // up
                    case 66:
                        y=speed;
			x = lx;
                        break;
                    case 40:
                    case 70:
                        // down
                        y=-1*speed;
			x=lx;
                        break;
                    case 37:
                    case 76:
                        x=turn;
			y=ly;
                        //left
                        break;
                    case 39:
                    case 82:
                        x=-1*turn;
			y=ly;
                        // right
                        break;
                } 
                sendJoy(x,y);
            }

            function addControl() {
                var control = bodygetter;
                    console.log("-c-> open");
                    setInterval(function () {
                        sendHeartbeat();
                    }, 10000);
	        controlChannel = control;
                control.onmessage = function (e) {
                    var message = JSON.parse(e.data);
                    console.log("-c->" + JSON.stringify(message));
                };
                document.addEventListener('keydown',onkeydown);
                document.addEventListener('keyup',omu);
	        var video = document.getElementById('ownervideo');
            }
function pv(lab){
	PipeAV.dclabel = lab;
	PipeAV.videoHere("ownervideo",deviceduct);
	addControl();
	$('#buttons').hide(); 
}


</script>
<div id="buttons"> 
	<button type="button" class="btn btn-lg" onclick='pv("video-only");'>Drive</button>
	<button type="button" class="btn btn-lg" onclick='pv("rvr");'>Learn</button>
	<button type="button" class="btn btn-lg" onclick='pv("videodrive");'>Auto</button>
</div>
<div>
  <video id="ownervideo" playsinline="true" autoplay="autoplay" onclick='this.play();'></video>
</div>
</body>
</html>
